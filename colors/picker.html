<htm>

    <head>
        <style>
            input{
                width: 100px;
                height: 100px;
            }
            body{
                font-family: monospace;
            }
        </style>
    </head>

    <body>
        <h1>Color Average</h1>

        <input id='color-1' type="color" value="#ff0000"> +
        <input id='color-2' type="color" value="#00ff00"> =
        <input id='color-3' type="color">
        <hr>
        <div id='c1'>-</div>
        <div id='c2'>-</div>
        <div id='c3'>-</div>

        <script>
            let colorPicker1 = document.getElementById('color-1')
            let colorPicker2 = document.getElementById('color-2')
            let colorPicker3 = document.getElementById('color-3')
            let c1 = document.getElementById('c1')
            let c2 = document.getElementById('c2')
            let c3 = document.getElementById('c3')
            let color1;
            let color2;
            let color3;

            updateColors();

            colorPicker1.addEventListener("input", function () {
                updateColors()
            });
            colorPicker2.addEventListener("input", function () {
                updateColors()
            });


            function getRGB(hex){
                let r = hex.substring(1,3);
                let g = hex.substring(3,5);
                let b = hex.substring(5,7);

                return {r: parseInt(r, 16), g: parseInt(g, 16), b: parseInt(b, 16)};
            }


            function getHex(rgb){
                return "#" + ("00" + rgb.r.toString(16)).slice(-2) + ("00" + rgb.g.toString(16)).slice(-2) + ("00" + rgb.b.toString(16)).slice(-2);
            }


            function getAngle(rgb){
                let y = (Math.sin(0) * rgb.r + Math.sin(Math.PI * 2/3) * rgb.g +  Math.sin(Math.PI * 4/3) * rgb.b)/3;
                let x = (Math.cos(0) * rgb.r + Math.cos(Math.PI * 2/3) * rgb.g +  Math.cos(Math.PI * 4/3) * rgb.b)/3;
                return Math.atan2(y, x);
            }


            function angleAverage(angles=[]){
                let x = 0;
                let y = 0;
                for(let i = 0; i < angles.length; i++){
                    x += Math.cos(angles[i]);
                    y += Math.sin(angles[i]);
                }
                if(angles.length){
                    x = x/angles.length;
                    y = y/angles.length;
                }

                return Math.atan2(y, x);
            }


            function sinx(x, n = 2*Math.PI) {
                x = x % n;
                if (x < n / 6) {
                    return x / (n / 6);

                } else if (x >= n / 6 && x <= n/2) {
                    return 1;

                } else if(x > n/2 && x <= 2*n/3){
                    return -(x / (n / 6)) + 4

                } else {
                    return 0;
                }
            }


            function updateColors(){
                // colorPicker3.value = colorPicker1.value

                color1 = getRGB(colorPicker1.value)
                color2 = getRGB(colorPicker2.value)
                // color3 = color1;

                let a1 = getAngle(color1);
                let a2 = getAngle(color2);
                
                let a3 = angleAverage([a1, a2]);
                let r3 = 255 * sinx(a3 + (2 * Math.PI / 3));
                let g3 = 255 * sinx(a3);
                let b3 = 255 * sinx(a3 + (4 * Math.PI / 3));
                color3 = {r: Math.round(r3), g: Math.round(g3), b: Math.round(b3)};
                colorPicker3.value = getHex(color3)



                c1.innerText = JSON.stringify(color1)
                c2.innerText = JSON.stringify(color2)
                c3.innerText = getHex(color3)
            }


        </script>

    </body>
</htm>